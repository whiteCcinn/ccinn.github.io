<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 4 | 白菜君の技术库</title>

  
  <meta name="author" content="白菜(whiteCcinn)">
  

  
  <meta name="description" content="知道做不到，等于不知道">
  

  
  <meta name="keywords" content="白菜,文辉,技术博客,whiteCcinn">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="白菜君の技术库"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="白菜君の技术库" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">白菜君の技术库</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives/">文章</a></li>
      
        <li><a href="/tags/">标签</a></li>
      
        <li><a href="/categories/">分类</a></li>
      
        <li><a href="/about/">关于我</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2020/12/17/Golang/使用golang重写tga服务/"><span>【Golang】- 使用golang重写tga服务</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/12/17/Golang/使用golang重写tga服务/" rel="bookmark">
        <time class="entry-date published" datetime="2020-12-17T01:46:51.000Z">
          2020-12-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>早期，在我们的部门中后端的技术栈语言主要有三种语言，分别是<code>php/python/erlang</code>，其中用于做服务的是 <code>php/erlang</code>。</p>
<p>在我们的体系中，日志采集服务体系目前都是用erlang写的，而php写的服务多是基于swoole写的一些基础服务。</p>
<p>在tga服务中，我们需要从<code>kafka</code> -&gt; <code>服务</code> -&gt; <code>本地文件</code>的模式。</p>
<p>业务据流图如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+---------------------------------------------------------------+</span><br><span class="line">|                                                               |</span><br><span class="line">|                                                               |</span><br><span class="line">|       +---------------------------------------------+         |</span><br><span class="line">|       |                                             |         |</span><br><span class="line">|       |                                             |         |</span><br><span class="line">|       |                  kafka服务                   |         |</span><br><span class="line">|       |                                             |         |</span><br><span class="line">|       |                                             |         |</span><br><span class="line">|       |                                             |         |</span><br><span class="line">|       +----------------------+----------------------+         |</span><br><span class="line">|                              |                                |</span><br><span class="line">|                              |                                |</span><br><span class="line">|       +----------------------v-----------------------+        |                     +----------------------------+</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       |               mthinkingdata服务               |        &lt;---------------------+          logbus服务        |</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       |                                              |        |                     |                            |</span><br><span class="line">|       +----------------------+-----------------------+        |                     +----------------------------+</span><br><span class="line">|                              |                                |</span><br><span class="line">|                              |                                |</span><br><span class="line">|       +----------------------v------------------------+       |</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       |                   本地文件                     +-------+</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       |                                               |       |</span><br><span class="line">|       +-----------------------------------------------+       |</span><br><span class="line">|                                                               |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure>


<p>于是我们试探性的自研基于swoole的kafka客户端，我们自己实现根据kafka协议的封包，解包，流程处理。(<code>swoole-kafka</code>)<br><code>mthinkingdata服务</code>就是我们基于<code>kafka-swoole</code>研发的业务服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+------------+</span><br><span class="line">|            |</span><br><span class="line">|  message1  +------------+</span><br><span class="line">|            |            |</span><br><span class="line">+------------+            |</span><br><span class="line">                          |</span><br><span class="line">+------------+     +------+--------+</span><br><span class="line">|            |     |               |</span><br><span class="line">|  message2  +-----+   snappy压缩   |</span><br><span class="line">|            |     |               |</span><br><span class="line">+------------+     +------+--------+</span><br><span class="line">                           |</span><br><span class="line">+---------------+          |</span><br><span class="line">|               |          |</span><br><span class="line">| message[3..n] +----------+</span><br><span class="line">|               |</span><br><span class="line">+---------------+</span><br></pre></td></tr></table></figure>

<p>在这个过程中，我们发现php对于cpu密集型的处理存在瓶颈，因为我们在生产者一方如果发送多条协议的情况下，会经过 <code>snappy</code> 算法的压缩再推送以便减少network-io（增加cpu-io）。<br>消费者在接受消息的时候也是被压缩过的数据，所以我们需要解压，在这个解压的过程中，是个十分消费cpu的过程，即使我们当时是基于swoole4.3的协程版本来处理，<br>不行的是的抢占式协程当时并没有很好的完成，我们没办法达到快速的接受多个数据包的行为。消费速度也并不是特别理想。<br>在这个大环境下，我们还需要借助redis来作为中间的存储。而redis是单线程的，我们在这个过程中，试过使用<code>pipeline</code>等手段减少tcp中的响应包的带来的性能损耗。但是由于redis只能利用单核的缘故，批量处理一批指令后，最高的cpu利用率接近100%下无法再增长。<br>也因此，我们的服务注定无法达到很好的性能测试。</p>
<p>我们得出结论，当时服务的瓶颈在于：</p>
<ul>
<li><ol>
<li>php语言本身的性能</li>
</ol>
</li>
<li><ol start="2">
<li>swoole协程不支持抢占式调度</li>
</ol>
</li>
<li><ol start="3">
<li>未实现动态伸缩扩展worker数量（感兴趣可以去看看kafka-swoole的架构分享）</li>
</ol>
</li>
<li><ol start="4">
<li>redis未能利用多核，cpu利用率达到峰值</li>
</ol>
</li>
</ul>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Golang/">Golang</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Golang/">Golang</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/11/10/DevOps/Jenkins在明朝的运用/"><span>【DevOps】Jenkins的share-libraries明朝的运用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/11/10/DevOps/Jenkins在明朝的运用/" rel="bookmark">
        <time class="entry-date published" datetime="2020-11-10T08:44:30.000Z">
          2020-11-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本次我们不从Jenkins的部署架构和具体配置说明，我们主要围绕 <code>jenkinsfile</code> 的内部来讲解。</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/DevOps/">DevOps</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/DevOps/">DevOps</a><a href="/tags/Jenkins/">Jenkins</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/08/25/k8s/pause容器/"><span>【kubernetes】pause容器</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/08/25/k8s/pause容器/" rel="bookmark">
        <time class="entry-date published" datetime="2020-08-25T14:53:30.000Z">
          2020-08-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>k8s中有 <code>init容器</code>的概念，其中一个就是<code>pause容器</code>，<code>pause容器</code>是一个十分重要的概念，贯穿整个<code>Pod</code>的通信。</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/kubernetes/">kubernetes</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/kubernetes/">kubernetes</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/08/24/爬虫/Tutorial/"><span>【爬虫】- scrapy</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/08/24/爬虫/Tutorial/" rel="bookmark">
        <time class="entry-date published" datetime="2020-08-24T01:46:51.000Z">
          2020-08-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在和朋友写一个二手房的项目，需要用到爬虫，这里借助了scrapy来写。顺便整理了scrapy的用法.</p>
<p><a href="https://github.com/four-seas/source" target="_blank" rel="noopener">fous_seas/sources</a></p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/爬虫/">爬虫</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/爬虫/">爬虫</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/08/14/Golang/pprof性能分析/"><span>【Golang】- pprof性能分析</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/08/14/Golang/pprof性能分析/" rel="bookmark">
        <time class="entry-date published" datetime="2020-08-14T08:35:51.000Z">
          2020-08-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在开发一个golang的大数据服务，发现只要到了业务层性能就急剧下降，为了排查这个原因，使用pprof进行性能分析</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Golang/">Golang</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Golang/">Golang</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/08/14/Golang/dlv在线调试/"><span>【Golang】- devle</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/08/14/Golang/dlv在线调试/" rel="bookmark">
        <time class="entry-date published" datetime="2020-08-14T01:46:51.000Z">
          2020-08-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于我们可能断点调试程序，所以我们需要debug工具，对于golang来说，delve比gdb对go程序更友好。所以，我们今天来看看devle怎么debug程序</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Golang/">Golang</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Golang/">Golang</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/07/10/DevOps/Jenkins-shared-library/"><span>【DevOps】Jenkins-shared-library 实战</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/07/10/DevOps/Jenkins-shared-library/" rel="bookmark">
        <time class="entry-date published" datetime="2020-07-10T09:35:30.000Z">
          2020-07-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近公司用了 <code>jenkins</code> 做为 <code>CI/CD</code> 的工具，<code>jenkins</code>是什么，我就不和大家详细说明了。</p>
<p>今天主要讲的是 <code>jenkins</code> 的 <code>pipeline</code>，旧版的 jenkins 我不太了解，但是听说这个 pipeline 是新出的。</p>
<p>今天要讲的也不单单是<code>pipeline</code>，更是有强力干货<code>share-library</code>相关的内容。</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/DevOps/">DevOps</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/DevOps/">DevOps</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/18/docker/docker-apline的问题/"><span>【Docker】docker-apline的问题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/18/docker/docker-apline的问题/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-18T12:28:30.000Z">
          2020-06-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天领导发现了一个docker的问题，他在用apline作为基础镜像的时候，在公司的服务器上无法<code>ping baidu.com</code></p>
<p>但是我们却是能在nslookup中解析到域名。</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Docker/">Docker</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Docker/">Docker</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/16/大数据/docker构建基于Hadoop的大数据生态/"><span>【大数据】- docker构建基于Hadoop的大数据生态</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/16/大数据/docker构建基于Hadoop的大数据生态/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-16T10:07:40.000Z">
          2020-06-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>众所周知，hadoop的大数据生态的组件版本对依赖十分的繁杂，对此我们在如果需要用apache开源库来一点点堆起积木，有点繁琐<br>我们这个项目的目的只是为了更快更方便的构建大数据生态环境。<br>所以我们这里选择采用cdh的方式来构建大数据生态，但是由于我们希望在终端就部署好服务，而不需要客户端，所以这里就不选择用cmf</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/大数据/">大数据</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/大数据，Hadoop/">大数据，Hadoop</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/12/大数据/hadoop基本操作/"><span>【大数据】- Hadoop 基本操作</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/12/大数据/hadoop基本操作/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-12T01:56:40.000Z">
          2020-06-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于之前一直没有整理过hadoop的内容，或者说整理得比较少，所以觉得有必要</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/大数据/">大数据</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/大数据，Hadoop/">大数据，Hadoop</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/3/" class="pagination-prev">Prev</a>
  
  
  <a href="/page/5/" class="pagination-next">Next</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 白菜(whiteCcinn)
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>